<!DOCTYPE html>
<html lang="en">
    <head>
		<meta charset="UTF-8" />
		<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
		<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
		<meta name="viewport" content="width=device-width, initial-scale=1.0"> 
        <title>Oil Spill</title>
        <link rel="stylesheet" type="text/css" href="css/style.css" />
		<link href='http://fonts.googleapis.com/css?family=Lato:300,700' rel='stylesheet' type='text/css' />
		<script src="http://d3js.org/d3.v2.js"></script>
		<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    </head>
    <body>
        <div class="container">

			<section class="main">
				<div id="chart-container">
					<h2>Tweet Emotion Frequency During Obama's Oval Office Address (BP Oil Spill) 
					<button id="description" type="button" class="right btn btn-default" data-container="body" data-toggle="popover" data-placement="right" data-content="
						The BP Oil Spill was an ecological disaster that began on April 20, 2010 and spanned 84 days. This visualization contains tweets coded for emotion from trained classifiers. "><span class="glyphicon glyphicon-info-sign"></span></button></h2>


					<button id="accusation_tweet_before" type="button" class="btn btn-default" data-container="body" data-toggle="popover" data-placement="left" data-content='@MicheleBachmann @GOPLeader  6061    main reason #obama lets #oilspill into the #Gulf of Mexico http://tinyurl.com/2637oa4 Read about Nalco '><span class="glyphicon glyphicon-comment"></span></button>

					<button id="anger_tweet_before" type="button" class="btn btn-default" data-container="body" data-toggle="popover" data-placement="left" data-content='Sacrifice? How About 9 Holes Instead Of 18? http://bit.ly/9ohmxJ #gulf #golf'><span class="glyphicon glyphicon-comment"></span></button>

					<button id="disgust_tweet_before" type="button" class="btn btn-default" data-container="body" data-toggle="popover" data-placement="left" data-content='So at least were making SOME progress on capping the #OilSpill. I think Michael would be proud. Yet disgusted b/c we couldnt do it quicker!'><span class="glyphicon glyphicon-comment"></span></button>

					<button id="fear_tweet_before" type="button" class="btn btn-default" data-container="body" data-toggle="popover" data-placement="left" data-content='Great fear ~ what if ~ the new cap ~ does not ~ work #gogyohka #oilspill  -> 615'><span class="glyphicon glyphicon-comment"></span></button>

					<button id="happiness_tweet_before" type="button" class="btn btn-default" data-container="body" data-toggle="popover" data-placement="left" data-content='We are very excited to announce Dr. Riki Ott will be our keynote speaker for Spill into DC rally! http://bit.ly/95ZEJA #oilspill'><span class="glyphicon glyphicon-comment"></span></button>

					<button id="no_tweet_before" type="button" class="btn btn-default" data-container="body" data-toggle="popover" data-placement="left" data-content='RT @beyond_BP: Michelle Obama talks about BP oil spill. Transcript - Lynn Sweet http://bit.ly/dbDvsX #bp #oilspill'><span class="glyphicon glyphicon-comment"></span></button>

					<button id="sadness_tweet_before" type="button" class="btn btn-default" data-container="body" data-toggle="popover" data-placement="left" data-content='RT @greenforall: "Someone right now might be taking their last breath in the Gulf because of air pollution" @lisapjackson #oilspill #g4a'><span class="glyphicon glyphicon-comment"></span></button>

					<button id="surprise_tweet_before" type="button" class="btn btn-default" data-container="body" data-toggle="popover" data-placement="left" data-content='Gulf Oil Disaster: Planned Event To Cause Mass FEMA Evacuation? http://tinyurl.com/26ofz2l #oilspill 18:10:01'><span class="glyphicon glyphicon-comment"></span></button>


					</div>

					<script type="text/javascript">
						$('#description').popover();
						$('#accusation_tweet_before').popover();
						$('#anger_tweet_before').popover();
						$('#disgust_tweet_before').popover();
						$('#fear_tweet_before').popover();
						$('#happiness_tweet_before').popover();
						$('#no_tweet_before').popover();
						$('#sadness_tweet_before').popover();
						$('#surprise_tweet_before').popover();



						var margin = {top: 10, right: 40, bottom: 150, left: 60},
								width = 940 - margin.left - margin.right,
								height = 500 - margin.top - margin.bottom,
								contextHeight = 50;
								contextWidth = width * .5;


							
						var svg = d3.select("#chart-container").append("svg")
												.attr("width", width + margin.left + margin.right)
												.attr("height", (height + margin.top + margin.bottom + 20));
												
						d3.csv('data2.csv', createChart);
						
						function createChart(data){
							var countries = [];
							var charts = [];
							var maxDataPoint = 0;
							
							// Gets list of emotions
							for (var prop in data[0]) {
								if (data[0].hasOwnProperty(prop)) {
									if (prop != 'Time') {
										countries.push(prop);
									}
								}
							};
							
							var countriesCount = countries.length;
							var startYear = data[0].Year;
							var endYear = data[data.length - 1].Year;
							var chartHeight = height * (1 / countriesCount);
							
														
							// finds max data point
							data.forEach(function(d) {
								for (var prop in d) {
									if (prop=="Time") {
										continue;
									}
									else (d.hasOwnProperty(prop)) 
									{
										d[prop] = parseFloat(d[prop]);
										
										if (d[prop] > maxDataPoint) {
											maxDataPoint = d[prop];
										}
									}
								}
								
								// D3 needs a date object, let's convert it just one time
								d.Year = new Date("June 15, 2010 " + d["Time"]);


							});
				
							for(var i = 0; i < countriesCount; i++){
								charts.push(new Chart({
									data: data.slice(),
									id: i,
									name: countries[i],
									width: width,
									height: height * (1 / countriesCount),
									maxDataPoint: maxDataPoint,
									svg: svg,
									margin: margin,
									showBottomAxis: (i == countries.length - 1)
								}));

							}
							
							
							// context brush for zooming and panning
							var contextXScale = d3.time.scale()
								.range([0, contextWidth])
								.domain(charts[0].xScale.domain());	
							
							var contextAxis = d3.svg.axis()
								.scale(contextXScale)
								.tickSize(contextHeight)
								.tickPadding(-10)
								.orient("bottom");
							
							var contextArea = d3.svg.area()
							.interpolate("monotone")
							.x(function(d) { return contextXScale(d.date); })
							.y0(contextHeight)
							.y1(0);
				
							var brush = d3.svg.brush()
								.x(contextXScale)
								.on("brush", onBrush);
				
							var context = svg.append("g")
								.attr("class","context")
								.attr("transform", "translate(" + (margin.left + width * .25) + "," + (height + margin.top + chartHeight  + 50) + ")");
							
							context.append("g")
								.attr("class", "x axis top")
								.attr("transform", "translate(0,0)")
								.call(contextAxis)
																
							context.append("g")
								.attr("class", "x brush")
								.call(brush)
								.selectAll("rect")
									.attr("y", 0)
									.attr("height", 30);
							
							context.append("text")
								.attr("class","instructions")
								.attr("transform", "translate(0," + (contextHeight + 15) + ")")
								.text('Click and drag above to zoom / pan the data');
												
							function onBrush(){
								/* this will return a date range to pass into the chart object */
								var b = brush.empty() ? contextXScale.domain() : brush.extent();
								for(var i = 0; i < countriesCount; i++){
									charts[i].showOnly(b);

								}
							}
						}
						
						function Chart(options){
							this.chartData = options.data;
							this.width = options.width;
							this.height = options.height;
							this.maxDataPoint = options.maxDataPoint;
							this.svg = options.svg;
							this.id = options.id;
							this.name = options.name;
							this.margin = options.margin;
							this.showBottomAxis = options.showBottomAxis;
							
							var localName = this.name;

							/* XScale is time based */
							this.xScale = d3.time.scale()
								.range([0, this.width])
								.domain(d3.extent(this.chartData.map(function(d) { return d.Year; })));
							
							/* YScale is linear based on the maxData Point we found earlier */
							this.yScale = d3.scale.linear()
								.range([this.height,0])
								.domain([0,this.maxDataPoint]);
							var xS = this.xScale;
							var yS = this.yScale;
							
							//console.log(yS(100));

							var grad = this.svg.append("defs")
							     	.append("linearGradient")
							     	.attr("id", "grad")
							     	//.attr("gradientUnits", "userSpaceOnUse")
							     	.attr("x1", "0")
							     	.attr("y1", "0")
							     	.attr("x2", "0")
							     	.attr("y2", "100%")
							 
							    .selectAll("stop")
							    	.data([
							    		{offset:"0%", color:"rgb(227,26,28)"},
							    		{offset:"25%", color:"rgb(227,26,28)"},
							    		{offset:"25%", color: "rgb(253,141,60)"},
							    		{offset:"50%", color: "rgb(253,141,60)"},
							    		{offset:"50%", color: "rgb(254,204,92)"},
							    		{offset:"75%", color: "rgb(254,204,92)"},
							    		{offset:"75%", color: "rgb(255,255,178)"},
							    		{offset:"100%", color:"rgb(255,255,178)"}
							    		])
							    .enter().append("stop")
							    	.attr("offset", function(d) { return d.offset; })
     								.attr("stop-color", function(d) { return d.color; });


							// creates chart
							this.area = d3.svg.area()
								//.interpolate("basis")
								.x(function(d) {return xS(d.Year); })
								.y0(this.height)
								.y1(function(d) {return yS(d[localName]); });
							
							// mask for zoom and pan
							this.svg.append("defs").append("clipPath")
								.attr("id", "clip-" + this.id)
								.append("rect")
									.attr("width", this.width)
									.attr("height", this.height);
							
							// assigning classes for css
							this.chartContainer = svg.append("g")
								.attr('class',this.name.toLowerCase())
								.attr("transform", "translate(" + this.margin.left + "," + (this.margin.top + (this.height * this.id) + (10 * this.id)) + ")");
														
							// Creating the path and rendering it
							this.chartContainer.append("path")
								.data([this.chartData])
								.attr("class", "chart")
								.attr("clip-path", "url(#clip-" + this.id + ")")
								.attr("d", this.area)
								.style("fill", "url(#grad)");

							//this.chartContainer.append("div")
							//	.id(localName + "before");
							
							this.xAxisTop = d3.svg.axis().scale(this.xScale).orient("bottom");
							this.xAxisBottom = d3.svg.axis().scale(this.xScale).orient("bottom");
							
							// Only top axis
							if(this.id == 0){
								this.chartContainer.append("g")
									.attr("class", "x axis top")
									.attr("transform", "translate(0,0)")
									.call(this.xAxisTop);
							}
							
							// Bottom axis only
							if(this.showBottomAxis){
									this.chartContainer.append("g")
										.attr("class", "x axis bottom")
										.attr("transform", "translate(0," + this.height + ")")
										.call(this.xAxisBottom);
								}  
								
							this.yAxis = d3.svg.axis().scale(this.yScale).orient("left").ticks(5);
								
							this.chartContainer.append("g")
								.attr("class", "y axis")
								.attr("transform", "translate(-15,0)")
								.call(this.yAxis);
																	
							this.chartContainer.append("text")
								.attr("class","emotion-title")
								.attr("transform", "translate(3,37)")
								.attr("fill", "#48729D")
								.text(this.name);
							
						}
							
						Chart.prototype.showOnly = function(b){
							this.xScale.domain(b);
							this.chartContainer.select("path").data([this.chartData]).attr("d", this.area);
							this.chartContainer.select(".x.axis.top").call(this.xAxisTop);
							this.chartContainer.select(".x.axis.bottom").call(this.xAxisBottom);
						}

						/* appends but does not show?
						window.onload = function WindowLoad(event) {
							var e = document.createElement('div');
							e.innerHTML = "<p>this is a test</p>";

							$(".accusation").append('<p>example</p>');
						} */
													
					</script>

				</div>
				
			</section>
			
        </div>
    </body>
</html>